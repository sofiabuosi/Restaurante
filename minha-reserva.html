<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Minha Reserva - Sabor Divino</title>
    <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Open+Sans:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Open Sans', sans-serif;
            background-color: #006400; /* Verde Fundo */
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 20px;
        }

        .card {
            background-color: white;
            color: #333;
            padding: 40px;
            border-radius: 10px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.3);
            max-width: 500px;
            width: 100%;
            text-align: center;
        }

        h1 { font-family: 'Great Vibes', cursive; font-size: 3.5rem; margin: 0; color: #006400; }
        h2 { font-size: 1.2rem; margin-bottom: 30px; color: #666; }

        .info-box {
            text-align: left;
            background-color: #f9f9f9;
            padding: 20px;
            border-radius: 5px;
            margin-bottom: 20px;
            border-left: 5px solid #006400;
        }

        .info-item { margin-bottom: 10px; border-bottom: 1px solid #eee; padding-bottom: 5px; }
        .info-item strong { color: #006400; }

        .btn {
            display: inline-block;
            padding: 15px 30px;
            border-radius: 5px;
            font-weight: bold;
            text-decoration: none;
            width: 100%;
            box-sizing: border-box;
            margin-top: 10px;
            cursor: pointer;
            border: none;
        }

        .btn-voltar { background-color: #333; color: white; }
        .btn-editar { background-color: #CD212A; color: white; display: none; /* Começa invisível */ }
        
        .aviso-tempo { font-size: 0.8rem; color: #888; margin-top: 10px; font-style: italic; }

    </style>
</head>
<body>

    <div class="card">
        <h1>Reserva Confirmada!</h1>
        <h2>Aqui estão os detalhes do seu pedido:</h2>

        <div class="info-box" id="detalhes">
            <p style="text-align:center">Carregando dados...</p>
        </div>

        <button onclick="editarReserva()" class="btn btn-editar" id="btnEditar">
            ✏️ Editar Reserva
        </button>
        <p id="msgTempo" class="aviso-tempo"></p>

        <a href="index.html" class="btn btn-voltar">Voltar ao Início</a>
    </div>

    <script>
        // 1. Recuperar dados do LocalStorage
        const dadosJSON = localStorage.getItem('dadosReservaSaborDivino');
        const display = document.getElementById('detalhes');
        const btnEditar = document.getElementById('btnEditar');
        const msgTempo = document.getElementById('msgTempo');

        if (dadosJSON) {
            const dados = JSON.parse(dadosJSON);

            // Montar o HTML com os dados
            display.innerHTML = `
                <div class="info-item"><strong>Data:</strong> ${formatarData(dados.data)}</div>
                <div class="info-item"><strong>Horário:</strong> ${dados.horario}</div>
                <div class="info-item"><strong>Pessoas:</strong> ${dados.pessoas}</div>
                <div class="info-item"><strong>Salada:</strong> ${dados.salada}</div>
                <div class="info-item"><strong>Prato:</strong> ${dados.principal}</div>
                <div class="info-item"><strong>Sobremesa:</strong> ${dados.sobremesa}</div>
            `;

            // 2. Lógica das 24 Horas
            verificarTempoEdicao(dados.data, dados.horario);

        } else {
            display.innerHTML = "<p>Nenhuma reserva encontrada neste dispositivo.</p>";
        }

        // Função auxiliar para formatar data (ano-mes-dia para dia/mes/ano)
        function formatarData(dataAmericana) {
            const partes = dataAmericana.split('-');
            return `${partes[2]}/${partes[1]}/${partes[0]}`;
        }

        // Função que calcula se pode editar
        function verificarTempoEdicao(dataReserva, horaReserva) {
            // Cria objeto Data com o dia e hora da reserva
            const dataDaReserva = new Date(`${dataReserva}T${horaReserva}:00`);
            const agora = new Date();

            // Diferença em milissegundos
            const diferenca = dataDaReserva - agora;

            // Converter para horas (milissegundos / 1000 / 60 / 60)
            const horasFaltantes = diferenca / (1000 * 60 * 60);

            if (horasFaltantes > 24) {
                // Se falta mais de 24h, mostra o botão
                btnEditar.style.display = 'inline-block';
                msgTempo.innerText = "Você pode editar esta reserva até 24h antes do horário.";
            } else {
                // Se falta menos de 24h (ou já passou)
                btnEditar.style.display = 'none';
                msgTempo.innerText = "Não é mais possível editar online (menos de 24h). Ligue para nós.";
            }
        }

        // Função para voltar e editar
        function editarReserva() {
            // Redireciona de volta para o formulário
            // Nota: O Formspree vai receber um *novo* email.
            // Cabe a você, dono do restaurante, ver que é o mesmo nome/data e atualizar.
            window.location.href = "reserva.html";
        }
    </script>

</body>
</html>
